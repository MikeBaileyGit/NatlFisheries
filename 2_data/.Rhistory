options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish_food_refusal, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','fs_refusals'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$fs_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','fs_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset_2.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset_2.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_2.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$refusal_weight, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','refusal_weight'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$refusal_weight), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','refusal_weight'))
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset_3.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset_3.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(ggplot2)
library(lmtest)
library(sandwich)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Base Model
ols.2 = lm(total_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M + USDA_t01xVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.2)
save(ols.2, file="output/analysis/ve_analysis_2_ols.RData")
coeftest(ols.2, vcov = vcovHC(ols.2, type="HC1"))
sigma(ols.2)
## Base Model
ols.2 = lm(total_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M + USDA_t01xVolume1M +  factor(month) + factor(country_cat), data= monthly)
summary(ols.2)
save(ols.2, file="output/analysis/ve_analysis_2_ols.RData")
coeftest(ols.2, vcov = vcovHC(ols.2, type="HC1"))
sigma(ols.2)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
monthly$import_volume_100k = monthly$import_volume / 100000
monthly$import_volume_1M   = monthly$import_volume / 1000000
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
monthly = monthly %>%
mutate(USDA_transition01 = ifelse((yrmonth >= as.yearmon("2016-03")) & (yrmonth < as.yearmon("2017-09")), 1, 0),
USDA01 = ifelse(yrmonth > as.yearmon("2017-08"), 1, 0))
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
monthly$USDAxVolume100k = monthly$USDA01 * monthly$import_volume_100k
monthly$USDAxVolume1M = monthly$USDA01 * monthly$import_volume_1M
monthly$USDA_t01xVolume1M = monthly$USDA_transition01 * monthly$import_volume_1M
monthly = monthly %>%
mutate(country_cat = ifelse(((country == "VIETNAM") | (country == "CHINA") | (country == "THAILAND")), country, "ROW"))
monthly$country_cat <- factor(monthly$country_cat, levels = c("ROW","VIETNAM", "CHINA", "THAILAND",))
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Cleaned import volume data
import = read.csv("output/build/monthly_cleaned.csv")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','total_refusals'))
## Create Year-Month variable for aggregation
import$yrmonth = format(as.Date(paste(import$year,import$month_number,"01", sep="-")),"%Y-%m")
## Aggregate refusals to a monthly level
monthlyVol = setNames(aggregate(import$volume_kg, by=list(import$yrmonth, import$country_name), FUN= sum), c('yrmonth','country','import_volume'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$total_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','total_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthlyRef, y= monthlyVol, by= c('yrmonth','country'), all.y= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
monthly$import_volume_100k = monthly$import_volume / 100000
monthly$import_volume_1M   = monthly$import_volume / 1000000
## Month & Year variables
typeof(monthly$yrmonth)
monthly$year = format(as.Date(paste(monthly$yrmonth,'-01',sep= '')), '%Y')
monthly$month = format(as.Date(paste(monthly$yrmonth,'-01',sep = '')), '%m')
typeof(monthly$year)
## Limit data to 2014 (FDA start) to 2020 February (USDA end)
monthly = monthly[monthly$year >= 2014,]
monthly = monthly[!(monthly$year == 2020 & !(monthly$month == '01' | monthly$month == '02')),]
monthly = monthly %>%
mutate(USDA_transition01 = ifelse((yrmonth >= as.yearmon("2016-03")) & (yrmonth < as.yearmon("2017-09")), 1, 0),
USDA01 = ifelse(yrmonth > as.yearmon("2017-08"), 1, 0))
## Interaction of USDA Authority and Volume
monthly$USDAxVolume = monthly$USDA01 * monthly$import_volume
monthly$USDAxVolume100k = monthly$USDA01 * monthly$import_volume_100k
monthly$USDAxVolume1M = monthly$USDA01 * monthly$import_volume_1M
monthly$USDA_t01xVolume1M = monthly$USDA_transition01 * monthly$import_volume_1M
monthly = monthly %>%
mutate(country_cat = ifelse(((country == "VIETNAM") | (country == "CHINA") | (country == "THAILAND")), country, "ROW"))
monthly$country_cat <- factor(monthly$country_cat, levels = c("ROW","VIETNAM", "CHINA", "THAILAND"))
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(ggplot2)
library(lmtest)
library(sandwich)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Base Model
ols.2 = lm(total_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M + USDA_t01xVolume1M +  factor(month) + factor(country_cat), data= monthly)
summary(ols.2)
save(ols.2, file="output/analysis/ve_analysis_2_ols.RData")
coeftest(ols.2, vcov = vcovHC(ols.2, type="HC1"))
sigma(ols.2)
## Base Model
ols.2.no = lm(total_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly[monthly$yrmonth != as.yearmon("Sep 2017"),])
summary(ols.2.no)
# Save residuals
Err = resid(ols.2)
# Generate lagged residual variable
LagErr = c(NA, Err[1:(length(Err)-1)])
# Auxiliary regression
LagErrOLS = lm(Err ~ LagErr)
# Display results
summary(LagErrOLS)
ggplot(monthly, aes(x= yrmonth, y= Err)) +
geom_point() +
labs(x= "Year-Month", y= "Error", title= "Plot of Residuals over Time Period") +
theme(axis.text.x= element_text(angle= 90, vjust= 0.5))
length(monthly$USDA01) ^ 0.25
NW_SE = sqrt(diag(NeweyWest(ols.2, lag= 4, prewhite= FALSE, adjust= TRUE)))
NW_SE
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
library(knitr)
library(car)
library(AER)
library(tidyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(lubridate)
library(RColorBrewer)
library(jtools)
library(stargazer)
library(huxtable)
## Combined FDA + USDA data
load("output/build/compositeImportRefusal.Rdata")
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset.Rdata")
## Create Year-Month variable for aggregation
composite$yrmonth = format(as.Date(composite$date),"%Y-%m")
## Aggregate refusal instances to a monthly level
monthlyRef = setNames(aggregate(composite$catfish_food_refusal, by=list(composite$yrmonth, composite$country_std), FUN= sum), c('yrmonth','country','fs_refusals'))
## Manual conversion of records with import refusal but no import volume for given month-country
# China - March 2016 -> February 2016
monthlyRef[monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2016-03" & monthlyRef$country == "CHINA")] = format(as.Date("2016-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2016-02" & monthlyRef$country == "CHINA",]
# Thailand - January 2018 -> November 2017 (Latest 2017 record)
monthlyRef[monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-01" & monthlyRef$country == "THAILAND")] = format(as.Date("2017-11-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2017-11" & monthlyRef$country == "THAILAND",]
# Thailand - May 2018 -> February 2018 (No other records in 2018)
monthlyRef[monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND",]
monthlyRef$yrmonth[(monthlyRef$yrmonth == "2018-05" & monthlyRef$country == "THAILAND")] = format(as.Date("2018-02-01"),"%Y-%m")
monthlyRef[monthlyRef$yrmonth == "2018-02" & monthlyRef$country == "THAILAND",]
monthlyRef = setNames(aggregate(as.numeric(monthlyRef$fs_refusals), by=list(monthlyRef$yrmonth, monthlyRef$country), FUN= sum), c('yrmonth','country','fs_refusals'))
# Limit to observations with import volume
monthly = merge(x= monthly, y= monthlyRef, by= c('yrmonth','country'), all.x= TRUE, fill= 0)
monthly[is.na(monthly)] = 0
## Export as CSV for comparison
write.csv(monthly, file="output/build/ve_analysis_dataset_2.CSV")
## Export as RData
save(monthly, file="output/build/ve_analysis_dataset_2.RData")
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(ggplot2)
library(lmtest)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_3.Rdata")
monthly$refusal_weight_1M = monthly$refusal_weight / 1000000
## Base Model
ols.4 = lm(refusal_weight_1M ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly)
summary(ols.4)
save(ols.4, file="output/analysis/ve_analysis_4_ols.RData")
coeftest(ols.4, vcov = vcovHC(ols.4, type="HC1"))
knitr::opts_chunk$set(echo = TRUE)
options(digits = 3)
options(scipen=999)
library(ggplot2)
library(lmtest)
## Combined FDA + USDA data
load("output/build/ve_analysis_dataset_2.Rdata")
## Base Model
ols.3 = lm(fs_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M + USDA_t01xVolume1M +  factor(month) + factor(country_cat), data= monthly)
summary(ols.3)
save(ols.3, file="output/analysis/ve_analysis_3_ols.RData")
coeftest(ols.3, vcov = vcovHC(ols.3, type="HC1"))
sigma(ols.3)
## Base Model
ols.3.no = lm(fs_refusals ~  USDA01 + USDA_transition01 + import_volume_1M + USDAxVolume1M +  factor(month) + factor(country), data= monthly[monthly$yrmonth != as.yearmon("Sep 2017"),])
summary(ols.3.no)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
#library(extrafont)
#font_import()
#library(tabulizer)
## Load linear regression results of models 1-3
load("output/analysis/ve_analysis_1_ols.Rdata")
load("output/analysis/ve_analysis_2_ols.Rdata")
load("output/analysis/ve_analysis_3_ols.Rdata")
result = data.frame(c(coef(ols.1)[2],coef(ols.2)[2],coef(ols.3)[2]))
result = cbind(result,(c("Model 1", "Model 2", "Model 3")))
colnames(result)
names(result)[names(result) == "c.coef.ols.1..2...coef.ols.2..2...coef.ols.3..2.."] = "usda_coef"
names(result)[names(result) == "(c(\"Model 1\", \"Model 2\", \"Model 3\"))"] = "model"
bluePalette <- c("#041E42","#6A98BA", "#CAE2E0")
## Plot of Coefficents
ggplot(result, aes(x= model, y= usda_coef, fill= model)) +
geom_bar(stat= "identity", legend= FALSE) +
labs(x= "", y= "", fill= "") +
theme_bw() +
theme(legend.position = "none") +
ylim(-2,12) +
geom_hline(yintercept= 0, color= "black") +
scale_fill_manual(values=bluePalette)
ggsave("output/figures/analysis/report_usdaCoefficients.png", dpi = 300)
## Plot of Coefficents
ggplot(result, aes(x= model, y= usda_coef, fill= model)) +
geom_bar(stat= "identity", legend= FALSE) +
labs(x= "", y= "", fill= "") +
theme_bw() +
ylim(-2,12) +
geom_hline(yintercept= 0, color= "black") +
scale_fill_manual(values=bluePalette)
bluePalette <- c("#041E42","#6A98BA", "#CAE2E0")
## Plot of Coefficents
ggplot(result, aes(x= model, y= usda_coef, fill= model)) +
geom_bar(stat= "identity", legend= FALSE) +
labs(x= "", y= "", fill= "") +
theme_bw() +
scale_x_discrete(labels = c("Total Refusals\nby USDA only", "Monthly Refusals\nby USDA and controls", "Food Safety Refusals\nby USDA and controls")) +
ylim(-2,12) +
geom_hline(yintercept= 0, color= "black") +
scale_fill_manual(values=bluePalette)
ggsave("output/figures/analysis/report_usdaCoefficients.png", dpi = 300)
View(result)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
#library(extrafont)
#font_import()
#library(tabulizer)
## Load linear regression results of models 1-3
load("output/analysis/ve_analysis_1_ols.Rdata")
load("output/analysis/ve_analysis_2_ols.Rdata")
load("output/analysis/ve_analysis_3_ols.Rdata")
result = data.frame(c(coef(ols.1)[2],coef(ols.2)[2],coef(ols.3)[2]))
result = cbind(result,(c("Model 1", "Model 2", "Model 3")))
colnames(result)
names(result)[names(result) == "c.coef.ols.1..2...coef.ols.2..2...coef.ols.3..2.."] = "usda_coef"
names(result)[names(result) == "(c(\"Model 1\", \"Model 2\", \"Model 3\"))"] = "model"
bluePalette <- c("#041E42","#6A98BA", "#CAE2E0")
## Plot of Coefficents
ggplot(result, aes(x= model, y= usda_coef, fill= model)) +
geom_bar(stat= "identity", legend= FALSE) +
labs(x= "", y= "", fill= "") +
theme_bw() +
scale_x_discrete(labels = c("Total Refusals\nby USDA only", "Total Refusals\nby USDA and controls", "Food Safety Refusals\nby USDA and controls")) +
ylim(-2,12) +
geom_hline(yintercept= 0, color= "black") +
scale_fill_manual(values=bluePalette)
ggsave("output/figures/analysis/report_usdaCoefficients.png", dpi = 300)
View(result)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(plyr)
library(dplyr)
library(countrycode)
library(lubridate)
library(ggplot2)
#library(extrafont)
#font_import()
#library(tabulizer)
load("output/build/ve_analysis_dataset_3.Rdata")
monthly = monthly %>%
mutate(country_viz = ifelse(((country == "VIETNAM") | (country == "CHINA") | (country == "THAILAND")), country, "All Other Countries"))
monthly$country_viz <- factor(monthly$country_viz, levels = c("VIETNAM", "CHINA", "THAILAND","All Other Countries"))
bluePalette <- c("#041E42", "#003D62", "#6A98BA", "#CAE2E0")
str(monthly)
monthly$yrmonth = as.yearmon(monthly$yrmonth)
## Monthly refusals over time period (Stacked Bar)
ggplot(monthly, aes(x= yrmonth, y= total_refusals, fill= country_viz)) +
geom_bar(position= "stack", stat= "identity") +
labs(x= "", y= "", fill= "Country") +
theme_bw() +
theme(axis.text.x= element_text(angle= 0, vjust= 0.5), text = element_text(size=16)) +
ylim(0, 100)  +
scale_x_yearmon(breaks = seq(from = as.yearmon(min(monthly$yrmonth)),
to = as.yearmon('2020-03'),
by = 0.5)) +
scale_fill_manual(values=bluePalette, labels = c("Vietnam", "China", "Thailand", "All Other Countries")) +
geom_vline(xintercept= as.yearmon("Mar 2016"), linetype= "dashed", color= "darkred") +
geom_vline(xintercept= as.yearmon("Sep 2017"), linetype= "dashed", color= "darkred") +
geom_hline(yintercept= 0)
monthly$country_viz <- factor(monthly$country_viz, levels = c("VIETNAM", "CHINA", "THAILAND","All Other Countries"))
bluePalette <- c("#041E42", "#003D62", "#6A98BA", "#CAE2E0")
str(monthly)
monthly$yrmonth = as.yearmon(monthly$yrmonth)
library(zoo)
monthly$country_viz <- factor(monthly$country_viz, levels = c("VIETNAM", "CHINA", "THAILAND","All Other Countries"))
bluePalette <- c("#041E42", "#003D62", "#6A98BA", "#CAE2E0")
str(monthly)
monthly$yrmonth = as.yearmon(monthly$yrmonth)
## Monthly refusals over time period (Stacked Bar)
ggplot(monthly, aes(x= yrmonth, y= total_refusals, fill= country_viz)) +
geom_bar(position= "stack", stat= "identity") +
labs(x= "", y= "", fill= "Country") +
theme_bw() +
theme(axis.text.x= element_text(angle= 0, vjust= 0.5), text = element_text(size=16)) +
ylim(0, 100)  +
scale_x_yearmon(breaks = seq(from = as.yearmon(min(monthly$yrmonth)),
to = as.yearmon('2020-03'),
by = 0.5)) +
scale_fill_manual(values=bluePalette, labels = c("Vietnam", "China", "Thailand", "All Other Countries")) +
geom_vline(xintercept= as.yearmon("Mar 2016"), linetype= "dashed", color= "darkred") +
geom_vline(xintercept= as.yearmon("Sep 2017"), linetype= "dashed", color= "darkred") +
geom_hline(yintercept= 0)
ggsave("output/figures/refusals/report_monthlyImportRefusalByCountryBar.png", dpi = 300)
